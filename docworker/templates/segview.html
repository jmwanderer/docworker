{% extends "base.html" %}
{% block backlink %}
<a href="{{ url_for('analysis.main', doc=doc.id(), run_id=run_id) }}">
  Main View
</a>
{% endblock %}
{% block body%}
  <h1>Text View</h1>
  <p>
    The Text View page shows the details for a specific block of the
    document or text generated by a GPT operation.
  </p>
  <hr>

  <div style="width: 100%;">
    {# TODO: add a parent link #} 
    <div style="width: 50%;float:left;">
      {% if not prev_item is none %}
      <a
	href="{{ url_for('analysis.segview', doc=doc.id(), run_id=run_id, item=prev_item.name()) }}">
	{{ prev_item.name() }}
      </a>
      {% endif %}
      &nbsp;      
    </div>
    <div style="width: 50%;float:right;text-align:right;">
      {% if not next_item is none %}
      <a
	href="{{ url_for('analysis.segview', doc=doc.id(), run_id=run_id, item=next_item.name()) }}">
	{{ next_item.name() }}
      </a>
      {% endif %}
      &nbsp;
    </div>	 
  </div>

  <h2>Text:</h2>
  <p>
    <b>
    {% if item.is_doc_segment() %}
    Section
    {% endif %}
    {{ item.name() }}:
    {% if not item.is_doc_segment() %}
    [
    {{ doc.prompt_name(item) }}
    ]
    {% endif %}
    </b>
  </p>
  
  {% if item.is_doc_segment() %}
  <pre style="line-height:1.5;background:{{ doc.item_color(item) }};white-space:pre-wrap;overflow-x:auto;padding:1em;margin:0;font-family:PT Mono;">{{ item.text() | e }}</pre>
  {% else %}
  <pre style="line-height:1.5;background:{{ doc.item_color(item) }};white-space:pre-wrap;overflow-x:auto;padding:1em;margin:0;font-family:PT Mono;">{{ item.text() | e }}</pre>
  {% endif %}

  {% if not item.is_doc_segment() %}
  <h2>Source Text:</h2>
  Generated using the following text:
  <table style="border-spacing:5px;">                
    {% for (indent, item) in source_list %}
    <tr>
      {% for i in range(1, indent - 1)  %}
      <td>
	&nbsp;&nbsp;&nbsp;&nbsp;
      </td>
      {% endfor %}
	  
      <td style="padding:2px;border-width:1px;border-style:solid;border-color:grey;"
	  colspan="{{ depth - indent + 1 }}">

	<div>
	{% if item.is_doc_segment() %}
	Section
	{% endif %}
	<a href="{{ url_for('analysis.segview', doc=doc.id(), run_id=run_id, item=item.name()) }}">
	  {{ item.name() }}:	    
	</a>
	  
	{% if not item.is_doc_segment() %}
	[
	{{ doc.prompt_str(item) }}
	]
	{% endif %}
	</div>
	
	<div style="background:{{ doc.item_color(item) }};padding:2px;">
	  {{ doc.snippet_text(item.text()) | e }}
	</div>
      </td>
    </tr>
    {% endfor %}
  </table>
  {% endif %}

  <div style="width: 100%;">
    <div style="width: 50%;float:left;">
      {% if not prev_item is none %}
      <a
	href="{{ url_for('analysis.segview', doc=doc.id(), run_id=run_id, item=prev_item.name()) }}">
	{{ prev_item.name() }}
      </a>
      {% endif %}
      &nbsp;      
    </div>
    <div style="width: 50%;float:right;text-align:right;">
      {% if not next_item is none %}
      <a
	href="{{ url_for('analysis.segview', doc=doc.id(), run_id=run_id, item=next_item.name()) }}">
	{{ next_item.name() }}
      </a>
      {% endif %}
      &nbsp;
    </div>	 
  </div>
  
{% endblock %}
